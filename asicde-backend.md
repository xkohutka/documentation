[<< Return to documentation overview](README.md)

[>> Go to repository](https://github.com/ASICDE/asicde-backend)

# ASICDE Backend

Contains all necessary source code artifacts to run backend features (API, parser, etc.). Application is developed in Java with support of Spring framework. Dependencies are handled using Maven. **There are other backend applications that do not use Java (not covered in this documentation)**. 

## Prerequisites for backend development
**Use Docker to build and modify backend applications (if they don't run Java).** Docker can also be used to modify the Java backend, it is not necessary but it can be helpful in certain cases.  [TODO: >> I want to use Docker for backend development](tba)


## Prerequisites for Java backend development (**without Docker**)
- JDK 13
    - Download and install JDK 13 (other versions may work as well, not tested)
        - (Optional) [Create Oracle account](https://profile.oracle.com/myprofile/account/create-account.jspx) if you don't have one yet
        - (Optional) [Download](https://www.oracle.com/java/technologies/javase/jdk13-archive-downloads.html) and install Java JDK 13 from archive 
    - Make sure you have `$JAVA_HOME` environment variable [set on your machine](https://www.thewindowsclub.com/set-java_home-in-windows-10)
    - Configure Java sources in your IDE as well to overcome issues such as dependency resolving failure 
- [Maven 3.6.3](https://maven.apache.org/download.cgi) 
    - Current version works as well
    - Download the package containing compiled binary files for your desired operating system
    - Extract the package
    - Set environment variables for `M2_HOME` and `MAVEN_HOME` to point to the base installation directory (same process as JAVA_HOME setup)
- [PostgreSQL 12](https://www.postgresql.org/download/)  
    - Current version of PostgreSQL works as well
    - Create database 'asicde' with owner {username: 'asicde', password: 'password'}
        - If you're using PgAdmin:
            - Create user: Servers -> Login / Group Roles -> Create -> 
                - General -> Name: 'asicde'
                - Definition -> Password: 'password'
                - Privileges -> allow all
                - -> Save
            - Create database: Servers -> Databases -> Create -> Database -> 
                - General -> Name: 'asicde'
                - General -> Owner: asicde 
                - -> Save
    - Created database should contain 'public' schema (generated by default) - this is necessary for database versioning engine to be able to initialize its proprietary tables inside this schema
- [IntelliJ IDEA](https://www.jetbrains.com/idea/download/) 
    - This guide is primarily centered on this IDE, as is offers integrated utilities for all necessary frameworks
    - (Optional) [Create Jetbrains student account](https://www.jetbrains.com/shop/eform/students) if you don't have one yet
    - (Optional) Download and use **Ultimate version**, login with your account
- (Optional) [Docker](https://www.docker.com/)
    - Containerization of the Java application. You may need Docker for other ASICDE projects, however you don't need Docker to run java backend

# Setting up a development environment
This section describes the process of setting up a development environment for Java backend of ASICDE project.


## Prerequisites
Make sure you set all [prerequisites](#prerequisites-for-java-backend-development-without-docker)


## Clone all backend repositories
It is advised to create one directory as your workspace, where you will clone all of the project repositories, so let's create it.
```bash
mkdir ASICDE
cd ASICDE
```


**Important:** make sure that you're using current branch of the project (master should work, else try dev). Don't forget to [checkout to your branch](https://www.git-tower.com/learn/git/commands/git-checkout/) when you start developing. [>> Learn more about branches in ASICDE project](dev-lifecycle.md)


Now navigate to your ACIDE directory then clone all backend repositories:

```bash
git clone https://github.com/ASICDE/asicde-parent.git
git clone https://github.com/ASICDE/asicde-api.git
git clone https://github.com/ASICDE/asicde-backend.git
```

## Install Maven dependencies
In order to run the Spring Boot projects, you first need to install projects using Maven in the following order:
  1. [parent](https://github.com/ASICDE/asicde-parent/)
  2. [api](https://github.com/ASICDE/asicde-api)
  3. [backend](https://github.com/ASICDE/asicde-backend)


(**Recomended:**) run maven commands in console as you may need some [additional arguments](https://maven.apache.org/plugins-archives/maven-surefire-plugin-2.12.4/examples/skipping-test.html). You can also install dependencies using IntelliJ (more on this later)

```bash
cd asicde-parent/
mvn clean
mvn install
cd ..
cd asicde-api/
mvn clean
mvn install
cd ..
mvn clean
mvn install #alternatively try: mvn install -DskipTests
```


## Module pre-requisites
- Build asicde-parent and asicde-api Maven projects 
    - Some projects are using Swagger-generated API and models, which need to be generated in binary form, as the backend modules are utilizing those. 

## Installation, build

Primarily, make sure you have every prerequisite installed and running correctly. 
To build the project, use following command in the project root folder:

```bash
mvn clean install 
```
This generates deployable and executable binaries, which can be found in the `{moduleName}/target` folder, or in your Maven repository folder.

## Running the application

In order to make Spring framework work correctly, set it's profiles to 'local' and 'default' - this loads the correct application context, with application properties injected in the code. 
To run the core application, simply execute the Spring boot application defined in AsicdeCoreApplication class. 

See [dev environment setup page](https://github.com/ASICDE/documentation/blob/master/dev-environment-setup.md) for additional application build and running information.

As for other modules, set the correct profiles (default, local) and launch the application. 

## Application launch

All real-time system logging is printed in the standard output (console). Additionally, you can enable Spring debug output for more verbose messaging
- set `logging.level.org.springframework.web=DEBUG` in application.properties
- provide `--debug` flag when executing the application 

Upon running the application itself, all necessary behind-the-scenes spring dependencies are resolved and injected - regarding persistence, security, application context, web context, ControllerAdvices etc. 

Database versioning is executed at this point as well - all necessary information is contained below, in the Database versioning sub-section.

After persistence dependencies are resolved, main beans are injected and web context is created. Ultimately, servlet listening to the API requests along with all API endpoints defined in RestController classes is exposed, and application is ready to receive requests.

## Core module 

Since the core module is the most significant one in the context of the web IDE, we provide closer look at this artifact. We omit the obvious or seamlessly insignificant features of this module.

### Configuration

Aside from configuration classes provided in asicde.core.config package, environment variables are contained in the `application.properties` file, residing in resources folder (the default, root resources folder). This file contains dependency configuration (persistence, database versioning, web configurations), but also custom variables (account verification, constants for scheduled tasks...). 

### Database versioning

Module uses Liquibase as it's database versioning engine. The root directory or the path to parent change log for the versioning files must be provided in application.properties. You can find versioning files (database changelogs) for this module in resources/db/changelog folder.

### Authentication, authorization

Even though auth-client is present, the authentication is mainly handled in core module, since it's the main point where user data is handled. Re-implementation of authentication server might be a matter of future work, if it is ever necessary.

REST API requests authorization is primarily evaluated with JWT token - see CoreSecurityConfig for actual path antMatchers, which are free of token authorization. Then, requests can be evaluated with `@PreAuthorize` expression at the endpoint level. In this module, it is mainly utilized to evaluate user access to certain resources, such as user-specific data, organization/team/classroom data etc.

### Error handling
Module `commons-error-handling` contains mostly all of the exceptions, which are thrown from the code at the request-processing time. You can customize, and add new error handlers in `commons-web` module, in the ErrorHandlingControllerAdvice.
